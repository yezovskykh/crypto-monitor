<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Crypto Monitor Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .market-trend {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-left: 5px solid #6c757d;
        }

        .market-trend.bullish {
            border-left-color: #28a745;
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.3) 0%, rgba(195, 230, 203, 0.3) 100%);
        }

        .market-trend.bearish {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, rgba(248, 215, 218, 0.3) 0%, rgba(245, 198, 203, 0.3) 100%);
        }

        .market-trend.neutral {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, rgba(255, 243, 205, 0.3) 0%, rgba(255, 234, 167, 0.3) 100%);
        }

        .trend-title {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .trend-description {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #555;
        }

        .trend-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            min-width: 120px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        .alerts-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .bullish-section {
            border-left: 5px solid #28a745;
        }

        .bearish-section {
            border-left: 5px solid #dc3545;
        }

        .htf-section {
            border-left: 5px solid #6f42c1;
            background: linear-gradient(135deg, #f8f9ff 0%, #e9ecff 100%);
        }

        .htf-card {
            border-left: 4px solid #6f42c1;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
        }

        .htf-score {
            background: linear-gradient(135deg, #6f42c1 0%, #8b5cf6 100%);
            color: white;
        }

        /* HTF Card Components */
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .coin-info {
            display: flex;
            flex-direction: column;
        }

        .coin-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }

        .coin-symbol {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .coin-rank {
            font-size: 0.8em;
            color: #999;
        }

        .score-badge {
            background: #007bff;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .price-info {
            margin-bottom: 15px;
        }

        .current-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .price-changes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .price-change-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .timeframe {
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }

        .market-info {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .market-info-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .market-info-item .label {
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }

        .market-info-item .value {
            font-size: 0.9em;
            color: #333;
            font-weight: bold;
        }

        .signals {
            margin-top: 15px;
        }

        .signals-title {
            font-size: 1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .signals-list {
            margin: 0;
            padding-left: 20px;
        }

        .signals-list li {
            margin-bottom: 5px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        /* Change indicators for HTF cards */
        .change {
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
        }

        .change.positive {
            background: #d4edda;
            color: #155724;
        }

        .change.negative {
            background: #f8d7da;
            color: #721c24;
        }

        .change.neutral {
            background: #e2e3e5;
            color: #383d41;
        }

        /* Tabbed Interface */
        .analysis-tabs {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 20px 30px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            color: #666;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.5);
            color: #333;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .tab-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tab-description {
            font-size: 1em;
            color: #666;
            line-height: 1.5;
        }

        .btc-section {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 3px solid #ff9800;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(255, 152, 0, 0.2);
        }

        .btc-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btc-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btc-logo {
            font-size: 2.5em;
            background: linear-gradient(135deg, #f7931a 0%, #ff9800 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btc-name {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .btc-price {
            font-size: 2.2em;
            font-weight: bold;
            color: #f7931a;
            text-align: right;
        }

        .btc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .btc-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #ffcc80;
        }

        .btc-card h4 {
            margin: 0 0 15px 0;
            color: #e65100;
            font-size: 1.1em;
            border-bottom: 2px solid #ffcc80;
            padding-bottom: 8px;
        }

        .btc-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .btc-metric {
            text-align: center;
            padding: 12px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            border: 1px solid #ffcc80;
        }

        .btc-metric-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .btc-metric-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .btc-metric-value.positive {
            color: #28a745;
        }

        .btc-metric-value.negative {
            color: #dc3545;
        }

        .btc-sentiment {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .btc-sentiment.very-bullish {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .btc-sentiment.bullish {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        .btc-sentiment.neutral {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .btc-sentiment.bearish {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .btc-sentiment.very-bearish {
            background: #f5c6cb;
            color: #491217;
            border: 2px solid #dc3545;
        }

        .btc-levels {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .btc-level {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .btc-level.support {
            background: #d4edda;
            color: #155724;
        }

        .btc-level.resistance {
            background: #f8d7da;
            color: #721c24;
        }

        .btc-level.current {
            background: #fff3cd;
            color: #856404;
        }

        .btc-trends {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .btc-trend {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ffcc80;
        }

        .btc-trend.up {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .btc-trend.down {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .btc-trend.flat {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        .btc-signals {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #ffcc80;
        }

        .btc-signals h4 {
            margin: 0 0 10px 0;
            color: #e65100;
        }

        .btc-signals ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .btc-signals li {
            margin-bottom: 8px;
            font-size: 0.95em;
            color: #333;
        }

        .market-cap-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 3px solid #4caf50;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(76, 175, 80, 0.2);
        }

        .market-cap-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .market-cap-title {
            font-size: 2em;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .market-cap-subtitle {
            font-size: 1.1em;
            color: #4caf50;
            margin-bottom: 20px;
        }

        .market-cap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .market-cap-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #a5d6a7;
        }

        .market-cap-card.total {
            border-color: #2e7d32;
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.1) 0%, rgba(165, 214, 167, 0.1) 100%);
        }

        .market-cap-card.total2 {
            border-color: #388e3c;
            background: linear-gradient(135deg, rgba(56, 142, 60, 0.1) 0%, rgba(129, 199, 132, 0.1) 100%);
        }

        .market-cap-card.total3 {
            border-color: #43a047;
            background: linear-gradient(135deg, rgba(67, 160, 71, 0.1) 0%, rgba(102, 187, 106, 0.1) 100%);
        }

        .market-cap-card h3 {
            margin: 0 0 15px 0;
            color: #1b5e20;
            font-size: 1.3em;
            text-align: center;
            border-bottom: 2px solid #a5d6a7;
            padding-bottom: 8px;
        }

        .market-cap-value {
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .market-cap-changes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .market-cap-change {
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #c8e6c9;
        }

        .market-cap-change-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .market-cap-change-value {
            font-size: 1em;
            font-weight: bold;
        }

        .market-cap-change-value.positive {
            color: #2e7d32;
        }

        .market-cap-change-value.negative {
            color: #d32f2f;
        }

        .market-cap-change-value.neutral {
            color: #666;
        }

        .market-phase {
            text-align: center;
            margin-bottom: 15px;
        }

        .market-phase-label {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .market-phase-label.bull-run {
            background: #c8e6c9;
            color: #1b5e20;
            border: 2px solid #4caf50;
        }

        .market-phase-label.bull-market {
            background: #dcedc8;
            color: #33691e;
            border: 2px solid #8bc34a;
        }

        .market-phase-label.recovery {
            background: #f0f4c3;
            color: #827717;
            border: 2px solid #cddc39;
        }

        .market-phase-label.consolidation {
            background: #fff3e0;
            color: #e65100;
            border: 2px solid #ff9800;
        }

        .market-phase-label.correction {
            background: #ffcdd2;
            color: #b71c1c;
            border: 2px solid #f44336;
        }

        .market-phase-label.bear-market {
            background: #ffcdd2;
            color: #b71c1c;
            border: 2px solid #f44336;
        }

        .market-phase-label.decline {
            background: #ffcdd2;
            color: #c62828;
            border: 2px solid #f44336;
        }

        .momentum-indicator {
            text-align: center;
            margin-bottom: 15px;
        }

        .momentum-label {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .momentum-label.very-bullish {
            background: #c8e6c9;
            color: #1b5e20;
        }

        .momentum-label.bullish {
            background: #dcedc8;
            color: #33691e;
        }

        .momentum-label.neutral {
            background: #f5f5f5;
            color: #424242;
        }

        .momentum-label.bearish {
            background: #ffcdd2;
            color: #b71c1c;
        }

        .momentum-label.very-bearish {
            background: #ffcdd2;
            color: #b71c1c;
        }

        .market-cap-signals {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #c8e6c9;
        }

        .market-cap-signals h4 {
            margin: 0 0 10px 0;
            color: #2e7d32;
            font-size: 1em;
        }

        .market-cap-signals ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .market-cap-signals li {
            margin-bottom: 6px;
            font-size: 0.9em;
            color: #333;
        }

        .market-relationships {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #81c784;
            margin-top: 20px;
        }

        .market-relationships h4 {
            margin: 0 0 15px 0;
            color: #2e7d32;
            text-align: center;
            font-size: 1.2em;
        }

        .dominance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .dominance-item {
            text-align: center;
            padding: 12px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            border: 1px solid #c8e6c9;
        }

        .dominance-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .dominance-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2e7d32;
        }

        .market-leader {
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border-radius: 10px;
            border: 2px solid #4caf50;
            margin-bottom: 15px;
        }

        .market-leader-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #1b5e20;
            margin-bottom: 5px;
        }

        .market-leader-description {
            font-size: 0.9em;
            color: #2e7d32;
        }

        .cycle-section {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border: 3px solid #9c27b0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(156, 39, 176, 0.2);
        }

        .cycle-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .cycle-title {
            font-size: 2em;
            font-weight: bold;
            color: #4a148c;
            margin-bottom: 10px;
        }

        .cycle-subtitle {
            font-size: 1.1em;
            color: #7b1fa2;
            margin-bottom: 20px;
        }

        .cycle-overview {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #ba68c8;
        }

        .cycle-phase {
            text-align: center;
            margin-bottom: 20px;
        }

        .cycle-phase-label {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .cycle-phase-label.cycle-top-warning {
            background: #ffcdd2;
            color: #b71c1c;
            border: 3px solid #f44336;
        }

        .cycle-phase-label.late-cycle {
            background: #ffe0b2;
            color: #e65100;
            border: 3px solid #ff9800;
        }

        .cycle-phase-label.mid-cycle {
            background: #fff3e0;
            color: #bf360c;
            border: 3px solid #ff5722;
        }

        .cycle-phase-label.early-cycle {
            background: #e8f5e8;
            color: #1b5e20;
            border: 3px solid #4caf50;
        }

        .cycle-phase-label.cycle-bottom-opportunity {
            background: #c8e6c9;
            color: #1b5e20;
            border: 3px solid #4caf50;
        }

        .cycle-description {
            font-size: 1em;
            color: #4a148c;
            text-align: center;
            margin-bottom: 15px;
        }

        .cycle-action {
            text-align: center;
            padding: 10px 20px;
            background: linear-gradient(135deg, #e1bee7 0%, #ce93d8 100%);
            border-radius: 20px;
            font-weight: bold;
            color: #4a148c;
            border: 2px solid #9c27b0;
        }

        .cycle-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .cycle-metric-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #ce93d8;
            text-align: center;
        }

        .cycle-metric-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #4a148c;
            margin-bottom: 10px;
        }

        .cycle-metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #7b1fa2;
            margin-bottom: 5px;
        }

        .cycle-metric-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
        }

        .risk-score {
            color: #d32f2f;
        }

        .opportunity-score {
            color: #2e7d32;
        }

        .cycle-bias.bullish {
            color: #2e7d32;
        }

        .cycle-bias.bearish {
            color: #d32f2f;
        }

        .cycle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .cycle-analysis-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #ce93d8;
        }

        .cycle-analysis-card.btc-cycle {
            border-color: #ff9800;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.05) 0%, rgba(255, 193, 7, 0.05) 100%);
        }

        .cycle-analysis-card.market-cycle {
            border-color: #4caf50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(129, 199, 132, 0.05) 100%);
        }

        .cycle-analysis-card.altcoin-cycle {
            border-color: #2196f3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.05) 0%, rgba(100, 181, 246, 0.05) 100%);
        }

        .cycle-analysis-card h4 {
            margin: 0 0 15px 0;
            color: #4a148c;
            font-size: 1.2em;
            text-align: center;
            border-bottom: 2px solid #ce93d8;
            padding-bottom: 8px;
        }

        .cycle-stage {
            text-align: center;
            margin-bottom: 15px;
        }

        .cycle-stage-label {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .cycle-stage-label.cycle-top {
            background: #ffcdd2;
            color: #b71c1c;
        }

        .cycle-stage-label.cycle-bottom {
            background: #c8e6c9;
            color: #1b5e20;
        }

        .cycle-stage-label.late-bull-run {
            background: #ffe0b2;
            color: #e65100;
        }

        .cycle-stage-label.early-bull-run {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .cycle-stage-label.bear-market {
            background: #ffcdd2;
            color: #c62828;
        }

        .cycle-stage-label.accumulation {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .cycle-stage-label.altcoin-season {
            background: #e3f2fd;
            color: #1565c0;
        }

        .cycle-stage-label.altcoin-bubble {
            background: #ffebee;
            color: #c62828;
        }

        .cycle-stage-label.altcoin-winter {
            background: #f5f5f5;
            color: #424242;
        }

        .cycle-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .cycle-indicator {
            text-align: center;
            padding: 10px;
            background: rgba(156, 39, 176, 0.1);
            border-radius: 8px;
            border: 1px solid #ce93d8;
        }

        .cycle-indicator-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .cycle-indicator-value {
            font-size: 1em;
            font-weight: bold;
            color: #4a148c;
        }

        .cycle-signals {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #ce93d8;
        }

        .cycle-signals h4 {
            margin: 0 0 10px 0;
            color: #4a148c;
            font-size: 1em;
        }

        .cycle-signals ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .cycle-signals li {
            margin-bottom: 6px;
            font-size: 0.9em;
            color: #333;
        }

        .historical-context {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #ba68c8;
            margin-top: 20px;
        }

        .historical-context h4 {
            margin: 0 0 15px 0;
            color: #4a148c;
            text-align: center;
            font-size: 1.2em;
        }

        .historical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .historical-item {
            text-align: center;
            padding: 12px;
            background: rgba(156, 39, 176, 0.1);
            border-radius: 8px;
            border: 1px solid #ce93d8;
        }

        .historical-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .historical-value {
            font-size: 1em;
            font-weight: bold;
            color: #4a148c;
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }

        .alerts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .alert-card {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .alert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .alert-card.high-score {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .alert-card.medium-score {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        }

        .crypto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .crypto-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .crypto-symbol {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
        }

        .crypto-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .crypto-price {
            font-size: 1.4em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }

        .price-changes {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .price-change {
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .price-change.positive {
            background: #d4edda;
            color: #155724;
        }

        .price-change.negative {
            background: #f8d7da;
            color: #721c24;
        }

        .price-change.neutral {
            background: #e2e3e5;
            color: #383d41;
        }

        .signals {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 12px;
        }

        .signals h4 {
            margin-bottom: 8px;
            color: #333;
        }

        .signals ul {
            list-style: none;
        }

        .signals li {
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #555;
        }

        .technical-panel {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border: 1px solid #b3d9ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .technical-panel.expanded {
            display: block !important;
        }

        .technical-toggle {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .technical-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .technical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .technical-section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 12px;
        }

        .technical-section h5 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 0.95em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 4px;
        }

        .technical-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.85em;
        }

        .technical-label {
            color: #666;
        }

        .technical-value {
            font-weight: bold;
            color: #333;
        }

        .technical-value.bullish {
            color: #28a745;
        }

        .technical-value.bearish {
            color: #dc3545;
        }

        .technical-value.neutral {
            color: #6c757d;
        }

        .support-resistance {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 20%);
            border-left: 4px solid #ff9800;
        }

        .moving-averages {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 20%);
            border-left: 4px solid #4caf50;
        }

        .oscillators {
            background: linear-gradient(135deg, #f3e5f5 0%, #ce93d8 20%);
            border-left: 4px solid #9c27b0;
        }

        .bollinger-bands {
            background: linear-gradient(135deg, #e3f2fd 0%, #90caf9 20%);
            border-left: 4px solid #2196f3;
        }

        .macd-section {
            background: linear-gradient(135deg, #fff8e1 0%, #ffcc02 20%);
            border-left: 4px solid #ff9800;
        }

        .rsi-gauge {
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, #28a745 0%, #ffc107 50%, #dc3545 100%);
            border-radius: 10px;
            position: relative;
            margin-top: 5px;
        }

        .rsi-indicator {
            position: absolute;
            top: -2px;
            width: 4px;
            height: 24px;
            background: #333;
            border-radius: 2px;
            transform: translateX(-2px);
        }

        .strength-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .strength-strong {
            background: #d4edda;
            color: #155724;
        }

        .strength-moderate {
            background: #fff3cd;
            color: #856404;
        }

        .strength-weak {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }

        .api-status-banner {
            margin-top: 15px;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.95em;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .api-status-banner.rate-limited {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            color: #856404;
        }

        .api-status-banner.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .api-status-banner.cached {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border: 2px solid #17a2b8;
            color: #0c5460;
        }

        .api-status-banner.healthy {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
            color: #155724;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .alerts-grid {
                grid-template-columns: 1fr;
            }
            
            .trend-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .price-changes {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Crypto Monitor Dashboard</h1>
            <p class="subtitle">Real-time cryptocurrency analysis and market trends</p>
            <div class="controls">
                <button class="btn" onclick="refreshData()">🔄 Refresh Data</button>
                <button class="btn" onclick="toggleAutoRefresh()">⏱️ Auto-refresh: <span id="auto-status">ON</span></button>
                <button class="btn" onclick="checkApiStatus()">📊 API Status</button>
            </div>
            <div id="api-status-banner" class="api-status-banner" style="display: none;"></div>
        </div>

        <div id="market-trend-section"></div>
        <div id="cycle-section"></div>
        <div id="market-cap-section"></div>
        <div id="btc-section"></div>
        
        <!-- Tabbed Analysis Interface -->
        <div class="analysis-tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('htf')">
                    📊 HTF Analysis
                </button>
                <button class="tab-button" onclick="switchTab('ltf')">
                    ⚡ LTF Analysis
                </button>
            </div>
            
            <div id="htf-tab" class="tab-content active">
                <div class="tab-header">
                    <div class="tab-title">📊 Higher Time Frame (HTF) Investment Analysis</div>
                    <div class="tab-description">
                        Long-term investment opportunities based on weekly and monthly trends. 
                        Focused on quality assets with sustainable growth patterns and strong fundamentals.
                    </div>
                </div>
                <div id="htf-section"></div>
            </div>
            
            <div id="ltf-tab" class="tab-content">
                <div class="tab-header">
                    <div class="tab-title">⚡ Lower Time Frame (LTF) Trading Analysis</div>
                    <div class="tab-description">
                        Short-term trading opportunities based on hourly and daily price movements. 
                        Includes both bullish momentum plays and bearish shorting opportunities.
                    </div>
                </div>
                <div id="bullish-section"></div>
                <div id="bearish-section"></div>
            </div>
        </div>
        <div id="loading" class="loading">Loading crypto data...</div>
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        let autoRefreshInterval;
        let isAutoRefreshOn = true;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            restoreTabState();
            loadData();
            startAutoRefresh();
        });

        async function loadData() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';

                const response = await fetch('/api/analysis');
                const result = await response.json();

                if (result.success) {
                    // Update API status banner
                    updateApiStatusBanner(result.apiStatus);
                    
                    displayMarketTrend(result.marketTrend);
                    displayCycleAnalysis(result.data.cycleAnalysis);
                    displayMarketCapAnalysis(result.data.marketCapAnalysis);
                    displayBTCAnalysis(result.data.btcAnalysis);
                    displayHTFAlerts(result.data.htfAlerts, result.data.totalAnalyzed);
                    displayBullishAlerts(result.data.bullishAlerts, result.data.totalAnalyzed);
                    displayBearishAlerts(result.data.bearishAlerts, result.data.totalAnalyzed);
                    document.getElementById('loading').style.display = 'none';
                } else {
                    throw new Error('Failed to fetch data');
                }
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error loading data: ' + error.message;
                
                // Show error banner
                showApiStatusBanner('⚠️ Connection error - please check your internet connection', 'error');
            }
        }

        function updateApiStatusBanner(apiStatus) {
            if (!apiStatus) return;
            
            const banner = document.getElementById('api-status-banner');
            
            if (apiStatus.isRateLimited) {
                const resetTime = apiStatus.rateLimitResetTime;
                const timeUntilReset = resetTime ? Math.max(0, Math.round((resetTime - Date.now()) / 1000 / 60)) : 'unknown';
                showApiStatusBanner(`🚫 API Rate Limited - Reset in ${timeUntilReset} minutes. Using cached data.`, 'rate-limited');
            } else if (apiStatus.lastSuccessfulFetch) {
                const lastFetchAge = Math.round((Date.now() - apiStatus.lastSuccessfulFetch) / 1000 / 60);
                if (lastFetchAge > 15) {
                    showApiStatusBanner(`📦 Using cached data (${lastFetchAge} minutes old) - API may be experiencing issues`, 'cached');
                } else if (lastFetchAge > 5) {
                    showApiStatusBanner(`📦 Using recent cached data (${lastFetchAge} minutes old)`, 'cached');
                } else {
                    hideApiStatusBanner();
                }
            } else {
                showApiStatusBanner('⚠️ No recent API data available - showing fallback information', 'error');
            }
        }

        function showApiStatusBanner(message, type) {
            const banner = document.getElementById('api-status-banner');
            banner.textContent = message;
            banner.className = `api-status-banner ${type}`;
            banner.style.display = 'block';
        }

        function hideApiStatusBanner() {
            const banner = document.getElementById('api-status-banner');
            banner.style.display = 'none';
        }

        async function checkApiStatus() {
            try {
                const response = await fetch('/api/status');
                const result = await response.json();
                
                if (result.success) {
                    const apiStatus = result.apiStatus;
                    const serverStatus = result.serverStatus;
                    
                    let statusMessage = '📊 API Status:\n\n';
                    
                    if (apiStatus.isRateLimited) {
                        statusMessage += `🚫 Rate Limited: Yes\n`;
                        statusMessage += `⏰ Reset in: ${apiStatus.timeUntilReset || 'unknown'} minutes\n`;
                    } else {
                        statusMessage += `✅ Rate Limited: No\n`;
                    }
                    
                    if (apiStatus.lastSuccessfulFetch) {
                        statusMessage += `📡 Last successful fetch: ${apiStatus.lastSuccessfulFetchAge} minutes ago\n`;
                    } else {
                        statusMessage += `📡 Last successful fetch: Never\n`;
                    }
                    
                    statusMessage += `📦 Cache available: ${apiStatus.cacheAvailable ? 'Yes' : 'No'}\n`;
                    statusMessage += `🔢 Total requests: ${apiStatus.requestCount}\n\n`;
                    
                    statusMessage += `🖥️ Server Status:\n`;
                    statusMessage += `⏱️ Uptime: ${Math.round(serverStatus.uptime / 60)} minutes\n`;
                    statusMessage += `💾 Memory: ${Math.round(serverStatus.memoryUsage.heapUsed / 1024 / 1024)}MB used`;
                    
                    alert(statusMessage);
                } else {
                    alert('Failed to fetch API status');
                }
            } catch (error) {
                console.error('Error checking API status:', error);
                alert('Error checking API status: ' + error.message);
            }
        }

        function displayMarketTrend(trend) {
            if (!trend) return;

            const trendClass = trend.trend.toLowerCase();
            const html = `
                <div class="market-trend ${trendClass}">
                    <div class="trend-title">${trend.emoji} Overall Market: ${trend.trend}</div>
                    <div class="trend-description">${trend.description}</div>
                    <div class="trend-stats">
                        <div class="stat-item">
                            <div class="stat-label">Bullish Coins</div>
                            <div class="stat-value">🐂 ${trend.details.bullishCoins}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Bearish Coins</div>
                            <div class="stat-value">🐻 ${trend.details.bearishCoins}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Neutral Coins</div>
                            <div class="stat-value">⚖️ ${trend.details.neutralCoins}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">24h Avg Change</div>
                            <div class="stat-value">${trend.details.avgChange24h}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">7d Avg Change</div>
                            <div class="stat-value">${trend.details.avgChange7d}%</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('market-trend-section').innerHTML = html;
        }

        function displayCycleAnalysis(cycleData) {
            if (!cycleData) {
                document.getElementById('cycle-section').innerHTML = `
                    <div class="cycle-section">
                        <div class="cycle-header">
                            <div class="cycle-title">🔄 Cycle Analysis</div>
                            <div class="cycle-subtitle">Market Top/Bottom Detection</div>
                        </div>
                        <p style="text-align: center; color: #666; font-style: italic;">Cycle analysis not available</p>
                    </div>
                `;
                return;
            }

            const createCycleCard = (cycleInfo, className, title) => {
                if (!cycleInfo) return '<div class="cycle-analysis-card"><p>Data not available</p></div>';

                const stageClass = cycleInfo.cycleStage.stage.toLowerCase().replace(/\s+/g, '-');
                
                return `
                    <div class="cycle-analysis-card ${className}">
                        <h4>${title}</h4>
                        
                        <div class="cycle-stage">
                            <div class="cycle-stage-label ${stageClass}">
                                ${cycleInfo.cycleStage.stage}
                            </div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                Confidence: ${cycleInfo.cycleStage.confidence}
                            </div>
                        </div>

                        ${cycleInfo.currentPrice ? `
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #4a148c;">
                                    $${typeof cycleInfo.currentPrice === 'number' ? cycleInfo.currentPrice.toLocaleString() : 'N/A'}
                                </div>
                                ${cycleInfo.priceFromATH ? `
                                    <div style="font-size: 0.9em; color: #666;">
                                        ${cycleInfo.priceFromATH}% from ATH | ${cycleInfo.priceFromATL}% from ATL
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        ${cycleInfo.indicators ? `
                            <div class="cycle-indicators">
                                ${cycleInfo.indicators.pricePosition ? `
                                    <div class="cycle-indicator">
                                        <div class="cycle-indicator-label">Position</div>
                                        <div class="cycle-indicator-value">${cycleInfo.indicators.pricePosition.position}%</div>
                                    </div>
                                ` : ''}
                                ${cycleInfo.indicators.momentum ? `
                                    <div class="cycle-indicator">
                                        <div class="cycle-indicator-label">Momentum</div>
                                        <div class="cycle-indicator-value">${cycleInfo.indicators.momentum.strength}</div>
                                    </div>
                                ` : ''}
                                ${cycleInfo.indicators.fearGreedIndex !== undefined ? `
                                    <div class="cycle-indicator">
                                        <div class="cycle-indicator-label">Fear/Greed</div>
                                        <div class="cycle-indicator-value">${cycleInfo.indicators.fearGreedIndex}</div>
                                    </div>
                                ` : ''}
                                <div class="cycle-indicator">
                                    <div class="cycle-indicator-label">Risk Score</div>
                                    <div class="cycle-indicator-value risk-score">${cycleInfo.riskScore.toFixed(1)}</div>
                                </div>
                                <div class="cycle-indicator">
                                    <div class="cycle-indicator-label">Opportunity</div>
                                    <div class="cycle-indicator-value opportunity-score">${cycleInfo.opportunityScore.toFixed(1)}</div>
                                </div>
                            </div>
                        ` : ''}

                        ${cycleInfo.signals && cycleInfo.signals.length > 0 ? `
                            <div class="cycle-signals">
                                <h4>🔍 Signals</h4>
                                <ul>
                                    ${cycleInfo.signals.map(signal => `<li>${signal}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            };

            const phaseClass = cycleData.cyclePhase ? cycleData.cyclePhase.phase.toLowerCase().replace(/\s+/g, '-') : '';

            document.getElementById('cycle-section').innerHTML = `
                <div class="cycle-section">
                    <div class="cycle-header">
                        <div class="cycle-title">🔄 Cycle Analysis</div>
                        <div class="cycle-subtitle">Market Top/Bottom Detection</div>
                    </div>

                    ${cycleData.cyclePhase ? `
                        <div class="cycle-overview">
                            <div class="cycle-phase">
                                <div class="cycle-phase-label ${phaseClass}">
                                    ${cycleData.cyclePhase.phase}
                                </div>
                            </div>
                            <div class="cycle-description">${cycleData.cyclePhase.description}</div>
                            <div class="cycle-action">Action: ${cycleData.cyclePhase.action}</div>
                            ${cycleData.cyclePhase.stability ? `
                                <div class="stability-metrics" style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 8px; border: 1px solid #ce93d8;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: #4a148c;">📊 Cycle Stability:</div>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; font-size: 0.8em;">
                                        <div style="text-align: center;">
                                            <div style="color: #666; font-size: 0.75em;">Stability</div>
                                            <div style="font-weight: bold; color: #4a148c;">${cycleData.cyclePhase.stability.stabilityRatio}%</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #666; font-size: 0.75em;">Switches</div>
                                            <div style="font-weight: bold; color: #4a148c;">${cycleData.cyclePhase.stability.recentSwitches}</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #666; font-size: 0.75em;">Avg Risk</div>
                                            <div style="font-weight: bold; color: #4a148c;">${cycleData.cyclePhase.stability.avgRisk}</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #666; font-size: 0.75em;">Avg Opp</div>
                                            <div style="font-weight: bold; color: #4a148c;">${cycleData.cyclePhase.stability.avgOpportunity}</div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    ${cycleData.overallCycle ? `
                        <div class="cycle-metrics">
                            <div class="cycle-metric-card">
                                <div class="cycle-metric-title">Risk Level</div>
                                <div class="cycle-metric-value risk-score">${cycleData.overallCycle.overallRiskScore}</div>
                                <div class="cycle-metric-label">${cycleData.riskLevel}</div>
                            </div>
                            <div class="cycle-metric-card">
                                <div class="cycle-metric-title">Opportunity</div>
                                <div class="cycle-metric-value opportunity-score">${cycleData.overallCycle.overallOpportunityScore}</div>
                                <div class="cycle-metric-label">Score</div>
                            </div>
                            <div class="cycle-metric-card">
                                <div class="cycle-metric-title">Cycle Bias</div>
                                <div class="cycle-metric-value cycle-bias ${cycleData.overallCycle.cycleBias.toLowerCase()}">${cycleData.overallCycle.cycleBias}</div>
                                <div class="cycle-metric-label">Strength: ${cycleData.overallCycle.cycleStrength}</div>
                            </div>
                            <div class="cycle-metric-card">
                                <div class="cycle-metric-title">Confidence</div>
                                <div class="cycle-metric-value">${cycleData.confidenceLevel}</div>
                                <div class="cycle-metric-label">Analysis Quality</div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="cycle-grid">
                        ${createCycleCard(cycleData.btcCycle, 'btc-cycle', '₿ Bitcoin Cycle')}
                        ${createCycleCard(cycleData.marketCycle, 'market-cycle', '📊 Market Cycle')}
                        ${createCycleCard(cycleData.altcoinCycle, 'altcoin-cycle', '🔄 Altcoin Cycle')}
                    </div>

                    ${cycleData.cycleSignals && cycleData.cycleSignals.length > 0 ? `
                        <div class="cycle-signals">
                            <h4>🚨 Cycle Signals</h4>
                            <ul>
                                ${cycleData.cycleSignals.map(signal => `<li>${signal}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    ${cycleData.historicalContext ? `
                        <div class="historical-context">
                            <h4>📈 Historical Context</h4>
                            <div class="historical-grid">
                                <div class="historical-item">
                                    <div class="historical-label">Last Cycle Top</div>
                                    <div class="historical-value">${cycleData.historicalContext.lastCycleTop}</div>
                                </div>
                                <div class="historical-item">
                                    <div class="historical-label">Last Cycle Low</div>
                                    <div class="historical-value">${cycleData.historicalContext.lastCycleLow}</div>
                                </div>
                                <div class="historical-item">
                                    <div class="historical-label">Cycle Length</div>
                                    <div class="historical-value">${cycleData.historicalContext.averageCycleLength}</div>
                                </div>
                                <div class="historical-item">
                                    <div class="historical-label">Current Start</div>
                                    <div class="historical-value">${cycleData.historicalContext.currentCycleStart}</div>
                                </div>
                                <div class="historical-item">
                                    <div class="historical-label">Next Halving</div>
                                    <div class="historical-value">${cycleData.historicalContext.nextHalving}</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function displayMarketCapAnalysis(marketCapData) {
            if (!marketCapData) {
                document.getElementById('market-cap-section').innerHTML = `
                    <div class="market-cap-section">
                        <div class="market-cap-header">
                            <div class="market-cap-title">📊 Market Cap Indices</div>
                            <div class="market-cap-subtitle">TOTAL • TOTAL2 • TOTAL3 Analysis</div>
                        </div>
                        <p style="text-align: center; color: #666; font-style: italic;">Market cap data not available</p>
                    </div>
                `;
                return;
            }

            const formatLargeNumber = (num) => {
                if (num === null || num === undefined || isNaN(num)) return 'N/A';
                if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                return num.toLocaleString();
            };

            const formatChange = (change) => {
                if (change === null || change === undefined || isNaN(change)) return '<span class="market-cap-change-value neutral">N/A</span>';
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const sign = change > 0 ? '+' : '';
                return `<span class="market-cap-change-value ${changeClass}">${sign}${change.toFixed(2)}%</span>`;
            };

            const createMarketCapCard = (data, className) => {
                if (!data) return '<div class="market-cap-card"><p>Data not available</p></div>';

                const phaseClass = data.marketPhase.phase.toLowerCase().replace(' ', '-');
                const momentumClass = data.momentum.momentum.toLowerCase().replace(' ', '-');

                return `
                    <div class="market-cap-card ${className}">
                        <h3>${data.name} (${data.symbol})</h3>
                        <div class="market-cap-value">$${formatLargeNumber(data.currentValue)}</div>
                        
                        <div class="market-cap-changes">
                            <div class="market-cap-change">
                                <div class="market-cap-change-label">1h</div>
                                ${formatChange(data.priceChanges.change1h)}
                            </div>
                            <div class="market-cap-change">
                                <div class="market-cap-change-label">24h</div>
                                ${formatChange(data.priceChanges.change24h)}
                            </div>
                            <div class="market-cap-change">
                                <div class="market-cap-change-label">7d</div>
                                ${formatChange(data.priceChanges.change7d)}
                            </div>
                            ${data.priceChanges.change30d !== undefined ? `
                                <div class="market-cap-change">
                                    <div class="market-cap-change-label">30d</div>
                                    ${formatChange(data.priceChanges.change30d)}
                                </div>
                            ` : ''}
                        </div>

                        <div class="market-phase">
                            <div class="market-phase-label ${phaseClass}">${data.marketPhase.phase}</div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                ${data.marketPhase.description}
                            </div>
                        </div>

                        <div class="momentum-indicator">
                            <div class="momentum-label ${momentumClass}">
                                ${data.momentum.momentum} (${data.momentum.score})
                            </div>
                            <div style="font-size: 0.8em; color: #666; margin-top: 3px;">
                                ${data.momentum.acceleration}
                            </div>
                        </div>

                        ${data.signals && data.signals.length > 0 ? `
                            <div class="market-cap-signals">
                                <h4>🔍 Signals</h4>
                                <ul>
                                    ${data.signals.map(signal => `<li>${signal}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            };

            document.getElementById('market-cap-section').innerHTML = `
                <div class="market-cap-section">
                    <div class="market-cap-header">
                        <div class="market-cap-title">📊 Market Cap Indices</div>
                        <div class="market-cap-subtitle">TOTAL • TOTAL2 • TOTAL3 Analysis</div>
                    </div>

                    <div class="market-cap-grid">
                        ${createMarketCapCard(marketCapData.total, 'total')}
                        ${createMarketCapCard(marketCapData.total2, 'total2')}
                        ${createMarketCapCard(marketCapData.total3, 'total3')}
                    </div>

                    ${marketCapData.analysis ? `
                        <div class="market-relationships">
                            <h4>🔗 Market Relationships</h4>
                            
                            ${marketCapData.analysis.marketLeader ? `
                                <div class="market-leader">
                                    <div class="market-leader-title">Market Leader: ${marketCapData.analysis.marketLeader.leader}</div>
                                    <div class="market-leader-description">${marketCapData.analysis.marketLeader.strength}</div>
                                    ${marketCapData.analysis.marketLeader.stability ? `
                                        <div class="stability-metrics" style="margin-top: 10px; padding: 10px; background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); border-radius: 6px; border: 1px solid #a5d6a7;">
                                            <div style="font-weight: bold; margin-bottom: 6px; color: #2e7d32; font-size: 0.9em;">📊 Leadership Stability:</div>
                                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 6px; font-size: 0.75em;">
                                                <div style="text-align: center;">
                                                    <div style="color: #666; font-size: 0.7em;">Stability</div>
                                                    <div style="font-weight: bold; color: #2e7d32;">${marketCapData.analysis.marketLeader.stability.stabilityRatio}%</div>
                                                </div>
                                                <div style="text-align: center;">
                                                    <div style="color: #666; font-size: 0.7em;">Switches</div>
                                                    <div style="font-weight: bold; color: #2e7d32;">${marketCapData.analysis.marketLeader.stability.recentSwitches}</div>
                                                </div>
                                                <div style="text-align: center;">
                                                    <div style="color: #666; font-size: 0.7em;">Margin</div>
                                                    <div style="font-weight: bold; color: #2e7d32;">${marketCapData.analysis.marketLeader.stability.margin}%</div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}

                            ${marketCapData.analysis.btcDominance || marketCapData.analysis.altcoinDominance ? `
                                <div class="dominance-grid">
                                    ${marketCapData.analysis.btcDominance ? `
                                        <div class="dominance-item">
                                            <div class="dominance-label">BTC Dominance</div>
                                            <div class="dominance-value">${marketCapData.analysis.btcDominance}%</div>
                                        </div>
                                    ` : ''}
                                    ${marketCapData.analysis.altcoinDominance ? `
                                        <div class="dominance-item">
                                            <div class="dominance-label">Altcoin Share</div>
                                            <div class="dominance-value">${marketCapData.analysis.altcoinDominance}%</div>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}

                            ${marketCapData.analysis.relationships && marketCapData.analysis.relationships.length > 0 ? `
                                <div class="market-cap-signals">
                                    <h4>📈 Market Dynamics</h4>
                                    <ul>
                                        ${marketCapData.analysis.relationships.map(rel => `<li>${rel}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function displayBTCAnalysis(btc) {
            if (!btc) {
                document.getElementById('btc-section').innerHTML = `
                    <div class="btc-section">
                        <div class="btc-header">
                            <div class="btc-title">
                                <div class="btc-logo">₿</div>
                                <div class="btc-name">Bitcoin Analysis</div>
                            </div>
                        </div>
                        <p style="text-align: center; color: #666; font-style: italic;">Bitcoin data not available</p>
                    </div>
                `;
                return;
            }

            const formatPrice = (price) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(price);
            };

            const formatLargeNumber = (num) => {
                if (num === null || num === undefined || isNaN(num)) return 'N/A';
                if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                return num.toLocaleString();
            };

            const formatChange = (change) => {
                if (change === null || change === undefined || isNaN(change)) return '<span class="btc-metric-value neutral">N/A</span>';
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const sign = change > 0 ? '+' : '';
                return `<span class="btc-metric-value ${changeClass}">${sign}${change.toFixed(2)}%</span>`;
            };

            const sentimentClass = btc.marketSentiment.sentiment.toLowerCase().replace(' ', '-');

            document.getElementById('btc-section').innerHTML = `
                <div class="btc-section">
                    <div class="btc-header">
                        <div class="btc-title">
                            <div class="btc-logo">₿</div>
                            <div class="btc-name">${btc.name}</div>
                        </div>
                        <div class="btc-price">${formatPrice(btc.currentPrice)}</div>
                    </div>

                    <div class="btc-grid">
                        <div class="btc-card">
                            <h4>📊 Market Metrics</h4>
                            <div class="btc-metrics">
                                <div class="btc-metric">
                                    <div class="btc-metric-label">Market Cap</div>
                                    <div class="btc-metric-value">$${formatLargeNumber(btc.marketCap)}</div>
                                </div>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">24h Volume</div>
                                    <div class="btc-metric-value">$${formatLargeNumber(btc.volume24h)}</div>
                                </div>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">Dominance</div>
                                    <div class="btc-metric-value">${btc.dominance}%</div>
                                </div>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">24h Range</div>
                                    <div class="btc-metric-value">${btc.dailyRange.range}%</div>
                                </div>
                            </div>
                        </div>

                        <div class="btc-card">
                            <h4>📈 Price Changes</h4>
                            <div class="btc-metrics">
                                <div class="btc-metric">
                                    <div class="btc-metric-label">1 Hour</div>
                                    ${formatChange(btc.priceChanges.change1h)}
                                </div>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">24 Hours</div>
                                    ${formatChange(btc.priceChanges.change24h)}
                                </div>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">7 Days</div>
                                    ${formatChange(btc.priceChanges.change7d)}
                                </div>
                                ${btc.priceChanges.change30d !== undefined ? `
                                    <div class="btc-metric">
                                        <div class="btc-metric-label">30 Days</div>
                                        ${formatChange(btc.priceChanges.change30d)}
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        <div class="btc-card">
                            <h4>🎯 Market Sentiment</h4>
                            <div style="text-align: center; margin-bottom: 15px;">
                                <div class="btc-sentiment ${sentimentClass}">
                                    ${btc.marketSentiment.sentiment}
                                </div>
                            </div>
                            <div class="btc-metric">
                                <div class="btc-metric-label">Confidence</div>
                                <div class="btc-metric-value">${btc.marketSentiment.confidence}</div>
                            </div>
                            <div class="btc-metric">
                                <div class="btc-metric-label">Volume Ratio</div>
                                <div class="btc-metric-value">${btc.marketSentiment.volumeRatio}%</div>
                            </div>
                        </div>

                        <div class="btc-card">
                            <h4>📊 Trend Analysis</h4>
                            <div class="btc-trends">
                                ${btc.trendAnalysis.map(trend => `
                                    <div class="btc-trend ${trend.direction.toLowerCase()}">
                                        <div style="font-weight: bold; font-size: 0.9em;">${trend.timeframe}</div>
                                        <div style="font-size: 0.8em;">${trend.direction}</div>
                                        <div style="font-size: 0.8em;">${trend.strength}</div>
                                        <div style="font-size: 0.85em; margin-top: 2px;">${trend.change > 0 ? '+' : ''}${trend.change}%</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        ${btc.keyLevels ? `
                            <div class="btc-card">
                                <h4>🎯 Key Levels</h4>
                                <div style="margin-bottom: 10px;">
                                    <strong>Daily Range:</strong> ${formatPrice(btc.keyLevels.dailyLow)} - ${formatPrice(btc.keyLevels.dailyHigh)}
                                </div>
                                <div class="btc-levels">
                                    ${btc.keyLevels.psychological.map(level => `
                                        <div class="btc-level ${level.type}">
                                            ${formatPrice(level.level)}
                                            <span style="font-size: 0.8em;">(${level.distance}%)</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${btc.volumeAnalysis ? `
                            <div class="btc-card">
                                <h4>📊 Volume Analysis</h4>
                                <div class="btc-metric">
                                    <div class="btc-metric-label">Volume Strength</div>
                                    <div class="btc-metric-value">${btc.volumeAnalysis.strength}</div>
                                </div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                                    ${btc.volumeAnalysis.analysis}
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    ${btc.marketSentiment.signals && btc.marketSentiment.signals.length > 0 ? `
                        <div class="btc-signals">
                            <h4>🔍 Market Signals</h4>
                            <ul>
                                ${btc.marketSentiment.signals.map(signal => `<li>${signal}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    ${btc.technicalAnalysis && btc.technicalAnalysis.available && btc.technicalAnalysis.technicalSignals && btc.technicalAnalysis.technicalSignals.length > 0 ? `
                        <div class="btc-signals">
                            <h4>📈 Technical Signals</h4>
                            <ul>
                                ${btc.technicalAnalysis.technicalSignals.map(signal => `<li>${signal}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createTechnicalAnalysisPanel(technical, symbol, tabType = 'default') {
            // Sanitize symbol for use as HTML ID
            const sanitizedSymbol = symbol.replace(/[^a-zA-Z0-9-_]/g, '');
            const uniqueId = `${sanitizedSymbol}-${tabType}`;
            
            if (!technical || !technical.available) {
                return `
                    <button class="technical-toggle" onclick="toggleTechnical('${uniqueId}')">
                        📊 Technical Analysis (Not Available)
                    </button>
                `;
            }

            const panelId = `technical-${uniqueId}`;
            
            return `
                <button class="technical-toggle" onclick="toggleTechnical('${uniqueId}')">
                    📊 Technical Analysis (${technical.priceDataPoints} ${technical.dataSource === 'sparkline' ? 'sparkline' : 'history'} points)
                </button>
                <div id="${panelId}" class="technical-panel">
                    <div class="technical-grid">
                        ${createSupportResistanceSection(technical.supportResistance)}
                        ${createMovingAveragesSection(technical.movingAverages)}
                        ${createRSISection(technical.rsi)}
                        ${technical.bollingerBands ? createBollingerBandsSection(technical.bollingerBands) : ''}
                        ${technical.macd ? createMACDSection(technical.macd) : ''}
                    </div>
                    ${technical.technicalSignals && technical.technicalSignals.length > 0 ? 
                        `<div style="margin-top: 15px;">
                            <h5>🎯 Technical Signals:</h5>
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                ${technical.technicalSignals.map(signal => `<li style="font-size: 0.9em; margin-bottom: 3px;">${signal}</li>`).join('')}
                            </ul>
                        </div>` : ''
                    }
                </div>
            `;
        }

        function createSupportResistanceSection(sr) {
            return `
                <div class="technical-section support-resistance">
                    <h5>🎯 Support & Resistance</h5>
                    <div class="technical-item">
                        <span class="technical-label">Resistance:</span>
                        <span class="technical-value">$${sr.resistance}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Support:</span>
                        <span class="technical-value">$${sr.support}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Pivot:</span>
                        <span class="technical-value">$${sr.pivot}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Strength:</span>
                        <span class="strength-indicator strength-${sr.strength}">${sr.strength}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">To Support:</span>
                        <span class="technical-value ${sr.distanceToSupport < 2 ? 'bullish' : 'neutral'}">${sr.distanceToSupport}%</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">To Resistance:</span>
                        <span class="technical-value ${sr.distanceToResistance < 2 ? 'bearish' : 'neutral'}">${sr.distanceToResistance}%</span>
                    </div>
                </div>
            `;
        }

        function createMovingAveragesSection(ma) {
            return `
                <div class="technical-section moving-averages">
                    <h5>📈 Moving Averages</h5>
                    ${ma.sma20 ? `
                        <div class="technical-item">
                            <span class="technical-label">SMA 20:</span>
                            <span class="technical-value">$${ma.sma20}</span>
                        </div>
                    ` : ''}
                    ${ma.sma50 ? `
                        <div class="technical-item">
                            <span class="technical-label">SMA 50:</span>
                            <span class="technical-value">$${ma.sma50}</span>
                        </div>
                    ` : ''}
                    ${ma.sma200 ? `
                        <div class="technical-item">
                            <span class="technical-label">SMA 200:</span>
                            <span class="technical-value">$${ma.sma200}</span>
                        </div>
                    ` : ''}
                    ${ma.ema12 ? `
                        <div class="technical-item">
                            <span class="technical-label">EMA 12:</span>
                            <span class="technical-value">$${ma.ema12}</span>
                        </div>
                    ` : ''}
                    ${ma.ema26 ? `
                        <div class="technical-item">
                            <span class="technical-label">EMA 26:</span>
                            <span class="technical-value">$${ma.ema26}</span>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createRSISection(rsi) {
            if (!rsi) return '';
            
            const rsiClass = rsi < 30 ? 'bullish' : rsi > 70 ? 'bearish' : 'neutral';
            const rsiPosition = Math.min(Math.max(rsi, 0), 100);
            
            return `
                <div class="technical-section oscillators">
                    <h5>📊 RSI Oscillator</h5>
                    <div class="technical-item">
                        <span class="technical-label">RSI (14):</span>
                        <span class="technical-value ${rsiClass}">${rsi}</span>
                    </div>
                    <div class="rsi-gauge">
                        <div class="rsi-indicator" style="left: ${rsiPosition}%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.7em; color: #666; margin-top: 2px;">
                        <span>Oversold</span>
                        <span>Neutral</span>
                        <span>Overbought</span>
                    </div>
                </div>
            `;
        }

        function createBollingerBandsSection(bb) {
            return `
                <div class="technical-section bollinger-bands">
                    <h5>📊 Bollinger Bands</h5>
                    <div class="technical-item">
                        <span class="technical-label">Upper:</span>
                        <span class="technical-value">$${bb.upper}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Middle:</span>
                        <span class="technical-value">$${bb.middle}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Lower:</span>
                        <span class="technical-value">$${bb.lower}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Bandwidth:</span>
                        <span class="technical-value">${bb.bandwidth}%</span>
                    </div>
                </div>
            `;
        }

        function createMACDSection(macd) {
            const macdClass = macd.histogram > 0 ? 'bullish' : 'bearish';
            
            return `
                <div class="technical-section macd-section">
                    <h5>📈 MACD</h5>
                    <div class="technical-item">
                        <span class="technical-label">MACD:</span>
                        <span class="technical-value">${macd.macd.toFixed(8)}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Signal:</span>
                        <span class="technical-value">${macd.signal.toFixed(8)}</span>
                    </div>
                    <div class="technical-item">
                        <span class="technical-label">Histogram:</span>
                        <span class="technical-value ${macdClass}">${macd.histogram.toFixed(8)}</span>
                    </div>
                </div>
            `;
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Remove active class from all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Show corresponding tab content
            const targetTab = document.getElementById(`${tabName}-tab`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Store current tab in localStorage for persistence
            localStorage.setItem('activeAnalysisTab', tabName);
        }
        
        // Restore tab state on page load
        function restoreTabState() {
            const savedTab = localStorage.getItem('activeAnalysisTab') || 'htf';
            
            // Remove active classes
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activate saved tab
            const tabButton = document.querySelector(`.tab-button[onclick="switchTab('${savedTab}')"]`);
            const tabContent = document.getElementById(`${savedTab}-tab`);
            
            if (tabButton && tabContent) {
                tabButton.classList.add('active');
                tabContent.classList.add('active');
            }
        }

        function toggleTechnical(uniqueId) {
            const panelId = `technical-${uniqueId}`;
            const panel = document.getElementById(panelId);
            
            if (panel) {
                panel.classList.toggle('expanded');
                
                // Update button text to show expand/collapse state
                const button = panel.previousElementSibling;
                if (button && button.classList.contains('technical-toggle')) {
                    const isExpanded = panel.classList.contains('expanded');
                    const originalText = button.textContent;
                    if (isExpanded && !originalText.includes('(Click to collapse)')) {
                        button.textContent = originalText.replace('(', '(Click to collapse) (');
                    } else if (!isExpanded && originalText.includes('(Click to collapse)')) {
                        button.textContent = originalText.replace('(Click to collapse) ', '');
                    }
                }
            } else {
                console.warn('Technical panel not found:', panelId);
            }
        }

        function createHTFAlertCard(alert) {
            const scoreClass = alert.score >= 8 ? 'high-score' : 'medium-score';
            
            const formatChange = (change) => {
                if (change === null || change === undefined || isNaN(change)) return '<span class="change neutral">N/A</span>';
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const sign = change > 0 ? '+' : '';
                return `<span class="change ${changeClass}">${sign}${change.toFixed(2)}%</span>`;
            };

            const formatPrice = (price) => {
                if (price >= 1) {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 6
                    }).format(price);
                } else {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 6,
                        maximumFractionDigits: 10
                    }).format(price);
                }
            };

            const formatLargeNumber = (num) => {
                if (num === null || num === undefined || isNaN(num)) return 'N/A';
                if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
                if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
                return num.toLocaleString();
            };

            return `
                <div class="alert-card htf-card ${scoreClass}">
                    <div class="alert-header">
                        <div class="coin-info">
                            <div class="coin-name">${alert.name}</div>
                            <div class="coin-symbol">${alert.symbol.toUpperCase()}</div>
                            <div class="coin-rank">Rank #${alert.rank}</div>
                        </div>
                        <div class="score-badge htf-score">HTF Score: ${alert.score}</div>
                    </div>
                    
                    <div class="price-info">
                        <div class="current-price">${formatPrice(alert.price)}</div>
                        <div class="price-changes">
                            <div class="price-change-item">
                                <span class="timeframe">1h:</span> ${formatChange(alert.change1h)}
                            </div>
                            <div class="price-change-item">
                                <span class="timeframe">24h:</span> ${formatChange(alert.change24h)}
                            </div>
                            <div class="price-change-item">
                                <span class="timeframe">7d:</span> ${formatChange(alert.change7d)}
                            </div>
                            <div class="price-change-item">
                                <span class="timeframe">30d:</span> ${formatChange(alert.change30d || 0)}
                            </div>
                        </div>
                    </div>

                    <div class="market-info">
                        <div class="market-info-item">
                            <span class="label">Market Cap:</span>
                            <span class="value">$${formatLargeNumber(alert.marketCap)}</span>
                        </div>
                        <div class="market-info-item">
                            <span class="label">Volume 24h:</span>
                            <span class="value">$${formatLargeNumber(alert.volume)}</span>
                        </div>
                    </div>

                    <div class="signals">
                        <div class="signals-title">📈 HTF Investment Signals:</div>
                        <ul class="signals-list">
                            ${alert.signals.map(signal => `<li>${signal}</li>`).join('')}
                        </ul>
                    </div>

                    ${alert.stability ? `
                        <div class="stability-metrics" style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); border-radius: 8px; border: 1px solid #b3d9ff;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #4a90e2;">📊 Stability Metrics:</div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; font-size: 0.85em;">
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.8em;">Avg Score</div>
                                    <div style="font-weight: bold; color: #4a90e2;">${alert.stability.avgScore}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.8em;">Consistency</div>
                                    <div style="font-weight: bold; color: #4a90e2;">${alert.stability.consistency}%</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.8em;">Variance</div>
                                    <div style="font-weight: bold; color: #4a90e2;">${alert.stability.variance}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #666; font-size: 0.8em;">Data Points</div>
                                    <div style="font-weight: bold; color: #4a90e2;">${alert.stability.dataPoints}</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    ${createTechnicalAnalysisPanel(alert.technicalAnalysis, alert.symbol, 'htf')}
                </div>
            `;
        }

        function createAlertCard(alert, type) {
            const scoreClass = alert.score >= 8 ? 'high-score' : 'medium-score';
            
            const formatChange = (change) => {
                if (change === null || change === undefined || isNaN(change)) return '<span class="price-change neutral">N/A</span>';
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const sign = change > 0 ? '+' : '';
                return `<span class="price-change ${changeClass}">${sign}${change.toFixed(2)}%</span>`;
            };

            const typeIcon = type === 'bullish' ? '🚀' : '🔻';
            const typeLabel = type === 'bullish' ? 'Long' : 'Short';

            return `
                <div class="alert-card ${scoreClass}">
                    <div class="crypto-header">
                        <div>
                            <div class="crypto-name">${typeIcon} ${alert.name}</div>
                            <div class="crypto-symbol">${alert.symbol.toUpperCase()} - ${typeLabel}</div>
                        </div>
                        <div class="crypto-score">Score: ${alert.score}</div>
                    </div>
                    
                    <div class="crypto-price">$${alert.price.toFixed(6)}</div>
                    
                    <div class="price-changes">
                        <div>1h: ${formatChange(alert.change1h)}</div>
                        <div>24h: ${formatChange(alert.change24h)}</div>
                        <div>7d: ${formatChange(alert.change7d)}</div>
                    </div>
                    
                    <div class="signals">
                        <h4>🔍 Detected Signals</h4>
                        <ul>
                            ${alert.signals.map(signal => `<li>${signal}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${createTechnicalAnalysisPanel(alert.technicalAnalysis, alert.symbol, 'ltf')}
                </div>
            `;
        }

        function displayHTFAlerts(alerts, totalAnalyzed) {
            if (!alerts) alerts = [];

            const alertsHtml = alerts.map(alert => createHTFAlertCard(alert)).join('');
            
            document.getElementById('htf-section').innerHTML = `
                <div class="alerts-section htf-section">
                    <div class="section-title">
                        💎 Investment Opportunities (${alerts.length} found)
                    </div>
                    ${alerts.length > 0 ? `
                        <div class="alerts-grid">
                            ${alertsHtml}
                        </div>
                    ` : `
                        <p style="text-align: center; color: #666; font-style: italic; margin: 20px 0;">
                            No HTF investment opportunities found at this time
                        </p>
                    `}
                </div>
            `;
        }

        function displayBullishAlerts(alerts, totalAnalyzed) {
            if (!alerts) alerts = [];

            const alertsHtml = alerts.map(alert => createAlertCard(alert, 'bullish')).join('');
            
            document.getElementById('bullish-section').innerHTML = `
                <div class="alerts-section bullish-section">
                    <div class="section-title">
                        🚀 Bullish Momentum - Long Positions (${alerts.length} found)
                    </div>
                    ${alerts.length > 0 ? `
                        <div class="alerts-grid">
                            ${alertsHtml}
                        </div>
                    ` : '<p style="text-align: center; color: #666; font-style: italic;">No bullish opportunities found at the moment.</p>'}
                </div>
            `;
        }

        function displayBearishAlerts(alerts, totalAnalyzed) {
            if (!alerts) alerts = [];

            const alertsHtml = alerts.map(alert => createAlertCard(alert, 'bearish')).join('');
            
            document.getElementById('bearish-section').innerHTML = `
                <div class="alerts-section bearish-section">
                    <div class="section-title">
                        🔻 Bearish Momentum - Short Positions (${alerts.length} found)
                    </div>
                    ${alerts.length > 0 ? `
                        <div class="alerts-grid">
                            ${alertsHtml}
                        </div>
                    ` : '<p style="text-align: center; color: #666; font-style: italic;">No bearish opportunities found at the moment.</p>'}
                </div>
            `;
        }

        async function refreshData() {
            const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
            refreshBtn.disabled = true;
            refreshBtn.textContent = '🔄 Refreshing...';

            try {
                await fetch('/api/refresh', { method: 'POST' });
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds for analysis
                await loadData();
            } catch (error) {
                console.error('Error refreshing data:', error);
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = '🔄 Refresh Data';
            }
        }

        function toggleAutoRefresh() {
            isAutoRefreshOn = !isAutoRefreshOn;
            const statusSpan = document.getElementById('auto-status');
            
            if (isAutoRefreshOn) {
                startAutoRefresh();
                statusSpan.textContent = 'ON';
            } else {
                stopAutoRefresh();
                statusSpan.textContent = 'OFF';
            }
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            autoRefreshInterval = setInterval(loadData, 5 * 60 * 1000); // 5 minutes
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }
    </script>
</body>
</html>
